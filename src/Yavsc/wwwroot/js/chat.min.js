!function(k){k.fn.filterByData=function(n,e){return this.filter(function(){return k(this).data(n)==e})};var e=function(n,e){if(!e)throw"not implemented";var a,i=Array(),o=(Array(),k("<ul></ul>").addClass("userlist")),s=k("<ul></ul>").addClass("notifs");o.appendTo(n),s.appendTo(n);var t=k.connection.chatHub;t.client.addMessage=function(n,e,a){k("#room_"+e).append('<li class="discussion"><strong>'+y(n)+"</strong>: "+y(a)+"</li>")},t.client.addPV=function(n,e){k("#mute").prop("checked")||m.play(),k("#pv_"+n).append('<li class="pv"><strong>'+y(n)+"</strong>: "+y(e)+"</li>")},t.client.notify=function(n,e){"connected"===n||"reconnected"===n?g(e):"disconnected"===n&&_(e),k("<li></li>").append(n+": ").append(e).addClass(n).appendTo(s)};var d=function(n){var e;""!==a&&((e=k("#vroom_"+a)).addClass("hidden"),k("#sel_"+a).addClass("btn-primary")),e=k("#vroom_"+(a=n)),k("#sel_"+n).removeClass("btn-primary"),e.removeClass("hidden")},c=k('<div class="chatbar"></div>'),r=k('<div class="chatctl" class="form-control"></div>'),l=k('<div class="roomlist"></div>');l.appendTo(c),k('<label for="channame">Join&nbsp;:</label>').appendTo(r);var p=k('<input id="channame" title="channel name" hint="yavsc"  >');p.appendTo(r),r.appendTo(c),c.appendTo(n);var u=k('<div class="chatlist" ></div>');u.appendTo(n);var v,h=function(e){var n=k("<a>"+e+"</a>").addClass("btn");n.prop("id","sel_"+e).click(function(){d(e),k(this).removeClass("btn-primary")}),n.appendTo(l);var a=k("<div></div>").addClass("container");a.appendTo(u),a.prop("id","vroom_"+e);var o=k("<ul></ul>").addClass("mesglist");o.prop("id","room_"+e),o.appendTo(a),k('<input type="text">').prop("id","inp_"+e).prop("enable",!1).prop("hint","hello").prop("title","send to "+e).addClass("form-control").keydown(function(n){if(13==n.which){if(0==this.value.length)return;t.server.send(e,this.value),this.value=""}}).appendTo(a),i.push(e),d(e)};function f(){setTimeout(function(){b()},120),k("#chatview").removeClass("disabled"),i.forEach(function(n){t.server.join(n).done(function(n){d(n.Name)})})}n.data("chans").split(",").forEach(function(n){h(n)}),k.connection.hub.start().done(function(){f()}),k.connection.hub.disconnected(function(){k("#chatview").addClass("disabled"),setTimeout(function(){k.connection.hub.start().done(function(){f()},3e4)})}),p.keydown(function(n){if(13==n.which){if(0==this.value.length)return;h(this.value),t.server.join(this.value).done(function(n){d(n.Name)}),this.value=""}});var m=new Audio("/sounds/bell.mp3");k("#pv").keydown(function(n){var e;13==n.which&&(e=k("#pv").val(),k.each(v.CXs,function(){t.server.sendPV(this,e)}),k("#discussion").append('<li class="pv">'+y(v.UserName)+"<< "+y(e)+"</li>"),k("#pv").val(""))}),k("#command").keydown(function(n){13==n.which&&sendCommand()});var C=function(n){k("#u_"+n).remove(),k('<li class="user"><img src="/Avatars/'+n+'.xs.png"> '+n+"</li>").prop("id","u_"+n).css("cursor","pointer").click(function(){T(this)}).appendTo(o)},b=function(){k.get("/api/chat/users").done(function(n){k.each(n,function(){C(this.UserName)})})};function y(n){return k("<div />").text(n).html()}var T=function(n){k("#rooms").addClass("hidden"),k("#sendpvbox").removeClass("hidden"),v={CXs:k(n).data("cxids"),UserName:k(n).data("name")},k("#sendpvdest").html(v.UserName),k("#pvs").focus()},w=function(){k("#rooms").removeClass("hidden"),k("#sendpvbox").addClass("hidden"),k("#message").focus()};k("#pubChan").css("cursor","pointer"),k("#pubChan").click(w),w();var _=function(n){k("#u_"+n).remove()},g=function(n){C(n)};k(window).unload(function(){t.server.abort()})};k(document).ready(function(n){e(n("#chatview"),!0)})}(jQuery);