!function(y){var i=function(n,i){if(!i)throw"not implemented";var e,a=Array(),s=y.connection.chatHub;s.client.addMessage=function(n,i,e){y("#room_"+i).append('<li class="discussion"><strong>'+f(n)+"</strong>: "+f(e)+"</li>")},s.client.addPV=function(n,i){y("#mute").prop("checked")||h.play(),y("#pv_"+n).append('<li class="pv"><strong>'+f(n)+"</strong>: "+f(i)+"</li>")},s.client.notify=function(n,i,e){e&&("connected"===n?(g(p,i,e),y("#notifications").append('<li class="notif"><i>'+f(n)+"</i> "+f(e)+"</li>")):"disconnected"===n?(b(p,i,e),y("#notifications").append('<li class="notif"><i>'+f(n)+"</i> "+f(e)+"</li>")):y("#notifications").append('<li class="notif"><i>'+f(n)+"</i> "+f(i)+" : <code>"+f(e)+"</code></li>"))},y.fn.filterByData=function(n,i){return this.filter(function(){return y(this).data(n)==i})};var o=function(n){var i;""!==e&&((i=y("#vroom_"+e)).addClass("hidden"),y("#sel_"+e).addClass("btn-primary")),i=y("#vroom_"+(e=n)),y("#sel_"+n).removeClass("btn-primary"),i.removeClass("hidden")},c=y('<div class="roomlist"></div>');c.appendTo(n);var d=y('<div class="chatlist" ></div>');d.appendTo(n);var t=function(i){var n=y("<a>"+i+"</a>").addClass("btn");n.prop("id","sel_"+i).click(function(){o(i),y(this).removeClass("btn-primary")}),n.appendTo(c);var e=y("<div></div>").addClass("container");e.appendTo(d),e.prop("id","vroom_"+i);var t=y("<ul></ul>").addClass("mesglist");t.prop("id","room_"+i),t.appendTo(e),y('<input type="text">').prop("id","inp_"+i).prop("enable",!1).prop("hint","hello").prop("title","send to "+i).addClass("form-control").keydown(function(n){if(13==n.which){if(0==this.value.length)return;console.log("sending to "+i+" "+this.value),s.server.send(i,this.value),this.value=""}}).appendTo(e),a.push(i),o(i)};function r(){setTimeout(function(){var e;y("#userlist").empty(),y("#to").empty(),y.get("/api/chat/users").done(function(n){y.each(n,function(){var n=y("#userlist li").filterByData("name",this.UserName);0<n.length&&n.remove();var i=[];y.each(this.Connections,function(){i.push(this.ConnectionId)}),v(e,this.UserName,i)})})},120),y("#chatview").removeClass("disabled"),a.forEach(function(n){s.server.join(n).done(function(n){console.log(n),o(n.Name)})})}n.data("chans").split(",").forEach(function(n){t(n)}),y.connection.hub.start().done(function(){r()}),y.connection.hub.disconnected(function(){y("#chatview").addClass("disabled"),setTimeout(function(){y.connection.hub.start().done(function(){r()},3e4)})}),y('<label for="channame">&gt;&nbsp;</label>').appendTo(n);var l=y('<input name="channame" title="channel name" hint="yavsc">');l.appendTo(n),l.keydown(function(n){if(13==n.which){if(0==this.value.length)return;t(this.value),s.server.join(this.value).done(function(n){console.log(n),o(n.Name)}),this.value=""}});var u,p=y("<ul></ul>").addClass("userlist");p.appendTo(n);var h=new Audio("/sounds/bell.mp3");function v(n,i,e){y('<li class="user"><img src="/Avatars/'+i+'.xs.png"> '+i+"</li>").data("name",i).data("cxids",e).css("cursor","pointer").click(function(){m(this)}).appendTo(n)}function f(n){return y("<div />").text(n).html()}y("#pv").keydown(function(n){var i;13==n.which&&(i=y("#pv").val(),y.each(u.CXs,function(){s.server.sendPV(this,i)}),y("#discussion").append('<li class="pv">'+f(u.UserName)+"<< "+f(i)+"</li>"),y("#pv").val(""))}),y("#command").keydown(function(n){13==n.which&&sendCommand()});var m=function(n){y("#rooms").addClass("hidden"),y("#sendpvbox").removeClass("hidden"),u={CXs:y(n).data("cxids"),UserName:y(n).data("name")},y("#sendpvdest").html(u.UserName),y("#pvs").focus()},C=function(){y("#rooms").removeClass("hidden"),y("#sendpvbox").addClass("hidden"),y("#message").focus()};y("#pubChan").css("cursor","pointer"),y("#pubChan").click(C),C();var b=function(i){y("#userlist li").filter(function(){var n=y(this).data("cxids").filter(function(){return y(this)!==i});0==n.length?y(this).remove():y(this).data("cxids",n)})},g=function(n,i,e){var t=y("#userlist li").filterByData("name",e);if(0<t.length){var a=t.data("cxids");a.push(i),t.data("cxids",a)}else v(n,e,[i])};y(window).unload(function(){s.server.abort()})};y(document).ready(function(n){i(n("#chatview"),!0)})}(jQuery);