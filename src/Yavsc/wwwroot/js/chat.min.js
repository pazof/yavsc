!function(w){var i=function(n,i){if(!i)throw"not implemented";var e,t,a=w.connection.chatHub;a.client.addMessage=function(n,i,e){w("#room_"+i).append('<li class="discussion"><strong>'+m(n)+"</strong>: "+m(e)+"</li>")},a.client.addPV=function(n,i){w("#mute").prop("checked")||v.play(),w("#pv_"+n).append('<li class="pv"><strong>'+m(n)+"</strong>: "+m(i)+"</li>")},a.client.notify=function(n,i,e){e&&("connected"===n?(y(h,i,e),w("#notifications").append('<li class="notif"><i>'+m(n)+"</i> "+m(e)+"</li>")):"disconnected"===n?(g(h,i,e),w("#notifications").append('<li class="notif"><i>'+m(n)+"</i> "+m(e)+"</li>")):w("#notifications").append('<li class="notif"><i>'+m(n)+"</i> "+m(i)+" : <code>"+m(e)+"</code></li>"))},a.client.onJoined=function(n){console.log(n),s(n.Name)},w.fn.filterByData=function(n,i){return this.filter(function(){return w(this).data(n)==i})};var s=function(n){e&&(e.addClass("hidden"),w("sel_"+t).addClass("btn-primary")),e=w("#vroom_"+n),t=n,e.removeClass("hidden")},o=w('<div class="roomlist"></div>');o.appendTo(n);var d=w('<div class="chatlist" ></div>');d.appendTo(n);var c=function(i){var n=w("<a>"+i+"</a>").addClass("btn").addClass("btn-primary");n.prop("id","sel_"+i).click(function(){s(i),w(this).removeClass("btn-primary")}),n.appendTo(o);var e=w("<div></div>").addClass("container");e.appendTo(d),e.prop("id","vroom_"+i);var t=w("<ul></ul>").addClass("mesglist");t.prop("id","room_"+i),t.appendTo(e),w('<input type="text">').prop("id","inp_"+i).prop("enable",!1).prop("hint","hello").prop("title","send to "+i).addClass("form-control").keydown(function(n){if(13==n.which){if(0==this.value.length)return;console.log("sending to "+i+" "+this.value),a.server.send(i,this.value),this.value=""}}).appendTo(e),r.push(i),s(i)},r=Array();function l(){setTimeout(function(){var e;w("#userlist").empty(),w("#to").empty(),w.get("/api/chat/users").done(function(n){w.each(n,function(){var n=w("#userlist li").filterByData("name",this.UserName);0<n.length&&n.remove();var i=[];w.each(this.Connections,function(){i.push(this.ConnectionId)}),f(e,this.UserName,i)})})},120),w("#chatview").removeClass("disabled"),r.forEach(function(n){a.server.join(n)})}n.data("chans").split(",").forEach(function(n){c(n)}),w.connection.hub.start().done(function(){l()}),w.connection.hub.disconnected(function(){w("#chatview").addClass("disabled"),setTimeout(function(){w.connection.hub.start().done(function(){l()},3e4)})}),w('<label for="channame">&gt;&nbsp;</label>').appendTo(n);var u=w('<input name="channame" title="channel name" hint="yavsc">');u.appendTo(n),u.keydown(function(n){if(13==n.which){if(0==this.value.length)return;c(this.value),a.server.join(this.value),this.value=""}});var p,h=w("<ul></ul>").addClass("userlist");h.appendTo(n);var v=new Audio("/sounds/bell.mp3");function f(n,i,e){w('<li class="user"><img src="/Avatars/'+i+'.xs.png"> '+i+"</li>").data("name",i).data("cxids",e).css("cursor","pointer").click(function(){C(this)}).appendTo(n)}function m(n){return w("<div />").text(n).html()}w("#pv").keydown(function(n){var i;13==n.which&&(i=w("#pv").val(),w.each(p.CXs,function(){a.server.sendPV(this,i)}),w("#discussion").append('<li class="pv">'+m(p.UserName)+"<< "+m(i)+"</li>"),w("#pv").val(""))}),w("#command").keydown(function(n){13==n.which&&sendCommand()});var C=function(n){w("#rooms").addClass("hidden"),w("#sendpvbox").removeClass("hidden"),p={CXs:w(n).data("cxids"),UserName:w(n).data("name")},w("#sendpvdest").html(p.UserName),w("#pvs").focus()},b=function(){w("#rooms").removeClass("hidden"),w("#sendpvbox").addClass("hidden"),w("#message").focus()};w("#pubChan").css("cursor","pointer"),w("#pubChan").click(b),b();var g=function(i){w("#userlist li").filter(function(){var n=w(this).data("cxids").filter(function(){return w(this)!==i});0==n.length?w(this).remove():w(this).data("cxids",n)})},y=function(n,i,e){var t=w("#userlist li").filterByData("name",e);if(0<t.length){var a=t.data("cxids");a.push(i),t.data("cxids",a)}else f(n,e,[i])};w(window).unload(function(){a.server.abort()})};w(document).ready(function(n){i(n("#chatview"),!0)})}(jQuery);