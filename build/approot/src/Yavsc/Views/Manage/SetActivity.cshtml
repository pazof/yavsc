@model PerformerProfile
@{
    ViewData["Title"] = "Setup your performer profile";
}

@section header{
    <script src="~/js/jquery-ui.js"></script>
    <script src="~/lib/jquery-validation/jquery.validate.js"></script>
    <script src="~/lib/jquery-validation/additional-methods.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
    <script src="~/js/validator.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=@ViewBag.GoogleSettings.BrowserApiKey"></script>
    <script src="~/js/google.geocode.js"></script>
    <style>
      #map {
        width: 100%;
        height: 250px;
      }
    </style>
}

@section scripts{
    <script>

     $(document).ready(function(){

          $('#Location_Address').geocode( { submit: 'btngeocode' ,
          inputLatitude: 'Location_Longitude',
          inputLongitude: 'Location_Latitude',
          combo: 'dropdownItems1',
          onValidated: function (e) {
              if (e.success) {
                  var firstres = e.results[0];
                  console.log(firstres);
                  console.log(firstres.geometry);
                $('#AddressError').html("");
              }
              else {
                 if (e.status=="ZERO_RESULTS") {
                    $('#AddressError').html("aucun résultat");
                  }
                  else  $('#AddressError').html(e.status);
              }
   } } );


          $.validator.addMethod("geocode", function(value, element) {
             console.log("here"); return $(element).geocodeAddress();});
          $("#FrmSetAct").validator({options: {
              errors: {
                 match: 'Non conforme.',
                 minlength: 'Pas assez long.',
                 geocode: 'Adresse non reconnue par Google.'
              }
          }})
    });
    </script>
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
 }

<h2>@ViewData["Title"].</h2>

@{ await Html.RenderPartialAsync("_PerformerPartial", Model) ; }

<form id="FrmSetAct" asp-controller="Manage" asp-action="SetActivity" method="post" class="form-horizontal" role="form">
    <h4>Choose below your main activity:</h4>
    <hr />
    <div asp-validation-summary="ValidationSummary.All" class="text-danger"></div>
    <div class="form-group">
        <label asp-for="ActivityCode" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <select asp-for="ActivityCode" asp-items=@ViewBag.Activities class="form-control" >
            </select>
            <span asp-validation-for="ActivityCode" class="text-danger"></span>
        </div>
     </div>
     <div class="form-group">
        <label asp-for="AcceptNotifications" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <input asp-for="AcceptNotifications" class="form-control" />
            <span asp-validation-for="AcceptNotifications" class="text-danger"></span>
        </div>
     </div>
     <div class="form-group">

        <label asp-for="AcceptPublicContact" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <input asp-for="AcceptPublicContact" class="form-control" />

            <span asp-validation-for="AcceptPublicContact" class="text-danger"></span>
        </div>
     </div>
     <div class="form-group">

        <label asp-for="AcceptGeoLocalisation" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <input asp-for="AcceptGeoLocalisation" class="form-control" />

            <span asp-validation-for="AcceptGeoLocalisation" class="text-danger"></span>
        </div>
     </div>
     <div class="form-group">

        <label asp-for="WebSite" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <input asp-for="WebSite" class="form-control" />

            <span asp-validation-for="WebSite" class="text-danger"></span>
        </div>
     </div>
     <div class="form-group">

        <label asp-for="MinDailyCost" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <input asp-for="MinDailyCost" class="form-control" />

            <span asp-validation-for="MinDailyCost" class="text-danger"></span>
        </div>
     </div>
     <div class="form-group">

        <label asp-for="MaxDailyCost" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <input asp-for="MaxDailyCost" class="form-control" />

            <span asp-validation-for="MaxDailyCost" class="text-danger"></span>
        </div>
     </div>
     <div class="form-group">

        <label asp-for="Active" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <input asp-for="Active"  class="form-control" />

            <span asp-validation-for="Active" class="text-danger"></span>
        </div>
     </div>
     <div class="form-group">

        <label asp-for="SIREN" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <input asp-for="SIREN"  class="form-control" />

            <span asp-validation-for="SIREN" class="text-danger"></span>
        </div>
     </div>
     <div class="form-group">

        <label asp-for="OrganisationAddress.Address" class="col-md-2 control-label"></label>
        <div class="col-md-10">
            <input asp-for="OrganisationAddress.Address" asp-items=@ViewBag.Activities class="form-control" type="text" />

            <span asp-validation-for="OrganisationAddress.Address" class="text-danger"></span>
            <div id="map"></div>
        </div>
     </div>
        @Html.Hidden("OrganisationAddress.Latitude")
        @Html.Hidden("OrganisationAddress.Longitude")
        @Html.Hidden("PerfomerId")
    <button type="submit" class="btn btn-default">Save these settings</button>

</form>

<form asp-controller="Manage" asp-action="UnsetActivity" method="post" class="form-horizontal" role="form">
    @Html.Hidden("PerfomerId")
    <button type="submit" class="btn btn-default">Remove my professional profile</button>
</form>
